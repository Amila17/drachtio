<!DOCTYPE html><html><head><title>Connect - High quality middleware for node.js</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" href="style.css"><script src="jquery.js"></script><script src="docs.js"></script></head><body><div id="content"><h1>Connect</h1><div id="" class="comment"><h2></h2><div class="description"><p>Error handler:</p>

<p>Development error handler, providing stack traces<br />and error message responses for requests accepting text, html,<br />or json.</p>

<p>Text:</p>

<p>By default, and when <em>text/plain</em> is accepted a simple stack trace<br />  or error message will be returned.</p>

<p>JSON:</p>

<p>When <em>application/json</em> is accepted, connect will respond with<br />  an object in the form of <code>{ "error": error }</code>.</p>

<p>HTML:</p>

<p>When accepted connect will output a nice html stack trace.</p></div><ul class="tags"><li>returns <em>Function</em> </li></ul><h3>Source</h3><pre><code>exports = module.exports = function errorHandler(){
  return function errorHandler(err, req, res, next){
    if (err.status) res.statusCode = err.status;
    if (res.statusCode < 400) res.statusCode = 500;
    if ('test' != env) console.error(err.stack);
    var accept = req.headers.accept || '';
    // html
    if (~accept.indexOf('html')) {
      fs.readFile(__dirname + '/../public/style.css', 'utf8', function(e, style){
        fs.readFile(__dirname + '/../public/error.html', 'utf8', function(e, html){
          var stack = (err.stack || '')
            .split('\n').slice(1)
            .map(function(v){ return '<li>' + v + '</li>'; }).join('');
            html = html
              .replace('{style}', style)
              .replace('{stack}', stack)
              .replace('{title}', exports.title)
              .replace('{statusCode}', res.statusCode)
              .replace(/\{error\}/g, utils.escape(err.toString()));
            res.setHeader('Content-Type', 'text/html; charset=utf-8');
            res.end(html);
        });
      });
    // json
    } else if (~accept.indexOf('json')) {
      var error = { message: err.message, stack: err.stack };
      for (var prop in err) error[prop] = err[prop];
      var json = JSON.stringify({ error: error });
      res.setHeader('Content-Type', 'application/json');
      res.end(json);
    // plain text
    } else {
      res.writeHead(res.statusCode, { 'Content-Type': 'text/plain' });
      res.end(err.stack);
    }
  };
};</code></pre></div><div id="exports.title" class="comment"><h2>exports.title</h2><div class="description"><p>Template title, framework authors may override this value.</p></div><h3>Source</h3><pre><code>exports.title = 'Connect';</code></pre></div></div><ul id="menu"><li><a href="#"></a></li><li><a href="#exports.title">exports.title</a></li></ul></body></html>