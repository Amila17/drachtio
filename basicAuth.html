<!DOCTYPE html><html><head><title>Connect - High quality middleware for node.js</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" href="style.css"><script src="jquery.js"></script><script src="docs.js"></script></head><body><div id="content"><h1>Connect</h1><div id="module.exports" class="comment"><h2></h2><div class="description"><p>Basic Auth:</p>

<p>Enfore basic authentication by providing a <code>callback(user, pass)</code>,<br />which must return <code>true</code> in order to gain access. Alternatively an async<br />method is provided as well, invoking <code>callback(user, pass, callback)</code>. Populates<br /><code>req.user</code>. The final alternative is simply passing username / password<br />strings.</p>

<p>Simple username and password</p>

<pre><code>connect(connect.basicAuth('username', 'password'));
</code></pre>

<p>Callback verification</p>

<pre><code>connect()
  .use(connect.basicAuth(function(user, pass){
    return 'tj' == user &amp;&amp; 'wahoo' == pass;
  }))
</code></pre>

<p>Async callback verification, accepting <code>fn(err, user)</code>.</p>

<pre><code>connect()
  .use(connect.basicAuth(function(user, pass, fn){
    User.authenticate({ user: user, pass: pass }, fn);
  }))
</code></pre></div><ul class="tags"><li><em>Function | String</em> callback or username</li><li><em>String</em> realm </li></ul><h3>Source</h3><pre><code>module.exports = function basicAuth(callback, realm) {
  var username, password;

  // user / pass strings
  if ('string' == typeof callback) {
    username = callback;
    password = realm;
    if ('string' != typeof password) throw new Error('password argument required');
    realm = arguments[2];
    callback = function(user, pass){
      return user == username && pass == password;
    }
  }

  realm = realm || 'Authorization Required';

  return function(req, res, next) {
    var authorization = req.headers.authorization;

    if (req.user) return next();
    if (!authorization) return unauthorized(res, realm);

    var parts = authorization.split(' ');

    if (parts.length !== 2) return next(utils.error(400));

    var scheme = parts[0]
      , credentials = new Buffer(parts[1], 'base64').toString()
      , index = credentials.indexOf(':');

    if ('Basic' != scheme || index < 0) return next(utils.error(400));
    
    var user = credentials.slice(0, index)
      , pass = credentials.slice(index + 1);

    // async
    if (callback.length >= 3) {
      var pause = utils.pause(req);
      callback(user, pass, function(err, user){
        if (err || !user)  return unauthorized(res, realm);
        req.user = req.remoteUser = user;
        next();
        pause.resume();
      });
    // sync
    } else {
      if (callback(user, pass)) {
        req.user = req.remoteUser = user;
        next();
      } else {
        unauthorized(res, realm);
      }
    }
  }
};</code></pre></div></div><ul id="menu"><li><a href="#module.exports"></a></li></ul></body></html>