<!DOCTYPE html><html><head><title>Connect - High quality middleware for node.js</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" href="style.css"><script src="jquery.js"></script><script src="docs.js"></script></head><body><div id="content"><h1>Connect</h1><div id="exports.hasBody" class="comment"><h2>exports.hasBody()</h2><div class="description"><p>Return <code>true</code> if the request has a body, otherwise return <code>false</code>.</p></div><ul class="tags"><li><em>IncomingMessage</em> req </li><li>returns <em>Boolean</em> </li></ul><h3>Source</h3><pre><code>exports.hasBody = function(req) {
  var encoding = 'transfer-encoding' in req.headers;
  var length = 'content-length' in req.headers && req.headers['content-length'] !== '0';
  return encoding || length;
};</code></pre></div><div id="exports.mime" class="comment"><h2>exports.mime()</h2><div class="description"><p>Extract the mime type from the given request's<br /><em>Content-Type</em> header.</p></div><ul class="tags"><li><em>IncomingMessage</em> req </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>exports.mime = function(req) {
  var str = req.headers['content-type'] || '';
  return str.split(';')[0];
};</code></pre></div><div id="exports.error" class="comment"><h2>exports.error()</h2><div class="description"><p>Generate an <code>Error</code> from the given status <code>code</code><br />and optional <code>msg</code>.</p></div><ul class="tags"><li><em>Number</em> code </li><li><em>String</em> msg </li><li>returns <em>Error</em> </li></ul><h3>Source</h3><pre><code>exports.error = function(code, msg){
  var err = new Error(msg || http.STATUS_CODES[code]);
  err.status = code;
  return err;
};</code></pre></div><div id="exports.md5" class="comment"><h2>exports.md5()</h2><div class="description"><p>Return md5 hash of the given string and optional encoding,<br />defaulting to hex.</p>

<pre><code>utils.md5('wahoo');
// =&gt; "e493298061761236c96b02ea6aa8a2ad"
</code></pre></div><ul class="tags"><li><em>String</em> str </li><li><em>String</em> encoding </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>exports.md5 = function(str, encoding){
  return crypto
    .createHash('md5')
    .update(str, 'utf8')
    .digest(encoding || 'hex');
};</code></pre></div><div id="exports.merge" class="comment"><h2>exports.merge()</h2><div class="description"><p>Merge object b with object a.</p>

<pre><code>var a = { foo: 'bar' }
  , b = { bar: 'baz' };

utils.merge(a, b);
// =&gt; { foo: 'bar', bar: 'baz' }
</code></pre></div><ul class="tags"><li><em>Object</em> a </li><li><em>Object</em> b </li><li>returns <em>Object</em> </li></ul><h3>Source</h3><pre><code>exports.merge = function(a, b){
  if (a && b) {
    for (var key in b) {
      a[key] = b[key];
    }
  }
  return a;
};</code></pre></div><div id="exports.escape" class="comment"><h2>exports.escape()</h2><div class="description"><p>Escape the given string of <code>html</code>.</p></div><ul class="tags"><li><em>String</em> html </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>exports.escape = function(html){
  return String(html)
    .replace(/&(?!\w+;)/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
};</code></pre></div><div id="exports.sign" class="comment"><h2>exports.sign()</h2><div class="description"><p>Sign the given <code>val</code> with <code>secret</code>.</p></div><ul class="tags"><li><em>String</em> val </li><li><em>String</em> secret </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>exports.sign = function(val, secret){
  console.warn('do not use utils.sign(), use https://github.com/visionmedia/node-cookie-signature')
  return val + '.' + crypto
    .createHmac('sha256', secret)
    .update(val)
    .digest('base64')
    .replace(/=+$/, '');
};</code></pre></div><div id="exports.unsign" class="comment"><h2>exports.unsign()</h2><div class="description"><p>Unsign and decode the given <code>val</code> with <code>secret</code>,<br />returning <code>false</code> if the signature is invalid.</p></div><ul class="tags"><li><em>String</em> val </li><li><em>String</em> secret </li><li>returns <em>String | Boolean</em> </li></ul><h3>Source</h3><pre><code>exports.unsign = function(val, secret){
  console.warn('do not use utils.unsign(), use https://github.com/visionmedia/node-cookie-signature')
  var str = val.slice(0, val.lastIndexOf('.'));
  return exports.sign(str, secret) == val
    ? str
    : false;
};</code></pre></div><div id="exports.parseSignedCookies" class="comment"><h2>exports.parseSignedCookies()</h2><div class="description"><p>Parse signed cookies, returning an object<br />containing the decoded key/value pairs,<br />while removing the signed key from <code>obj</code>.</p></div><ul class="tags"><li><em>Object</em> obj </li><li>returns <em>Object</em> </li></ul><h3>Source</h3><pre><code>exports.parseSignedCookies = function(obj, secret){
  var ret = {};
  Object.keys(obj).forEach(function(key){
    var val = obj[key];
    if (0 == val.indexOf('s:')) {
      val = signature.unsign(val.slice(2), secret);
      if (val) {
        ret[key] = val;
        delete obj[key];
      }
    }
  });
  return ret;
};</code></pre></div><div id="exports.parseSignedCookie" class="comment"><h2>exports.parseSignedCookie()</h2><div class="description"><p>Parse a signed cookie string, return the decoded value</p></div><ul class="tags"><li><em>String</em> str signed cookie string</li><li><em>String</em> secret </li><li>returns <em>String</em> decoded value</li></ul><h3>Source</h3><pre><code>exports.parseSignedCookie = function(str, secret){
  return 0 == str.indexOf('s:')
    ? signature.unsign(str.slice(2), secret)
    : str;
};</code></pre></div><div id="exports.parseJSONCookies" class="comment"><h2>exports.parseJSONCookies()</h2><div class="description"><p>Parse JSON cookies.</p></div><ul class="tags"><li><em>Object</em> obj </li><li>returns <em>Object</em> </li></ul><h3>Source</h3><pre><code>exports.parseJSONCookies = function(obj){
  Object.keys(obj).forEach(function(key){
    var val = obj[key];
    var res = exports.parseJSONCookie(val);
    if (res) obj[key] = res;
  });
  return obj;
};</code></pre></div><div id="exports.parseJSONCookie" class="comment"><h2>exports.parseJSONCookie()</h2><div class="description"><p>Parse JSON cookie string</p></div><ul class="tags"><li><em>String</em> str </li><li>returns <em>Object</em> Parsed object or null if not json cookie</li></ul><h3>Source</h3><pre><code>exports.parseJSONCookie = function(str) {
  if (0 == str.indexOf('j:')) {
    try {
      return JSON.parse(str.slice(2));
    } catch (err) {
      // no op
    }
  }
};</code></pre></div><div id="exports.pause" class="comment"><h2>exports.pause</h2><div class="description"><p>Pause <code>data</code> and <code>end</code> events on the given <code>obj</code>.<br />Middleware performing async tasks <em>should</em> utilize<br />this utility (or similar), to re-emit data once<br />the async operation has completed, otherwise these<br />events may be lost. Pause is only required for<br />node versions less than 10, and is replaced with<br />noop's otherwise.</p>

<pre><code> var pause = utils.pause(req);
 fs.readFile(path, function(){
    next();
    pause.resume();
 });
</code></pre></div><ul class="tags"><li><em>Object</em> obj </li><li>returns <em>Object</em> </li></ul><h3>Source</h3><pre><code>exports.pause = exports.brokenPause
  ? require('pause')
  : function () {
    return {
      end: noop,
      resume: noop
    }
  }</code></pre></div><div id="exports.removeContentHeaders" class="comment"><h2>exports.removeContentHeaders()</h2><div class="description"><p>Strip <code>Content-*</code> headers from <code>res</code>.</p></div><ul class="tags"><li><em>ServerResponse</em> res </li></ul><h3>Source</h3><pre><code>exports.removeContentHeaders = function(res){
  Object.keys(res._headers).forEach(function(field){
    if (0 == field.indexOf('content')) {
      res.removeHeader(field);
    }
  });
};</code></pre></div><div id="exports.conditionalGET" class="comment"><h2>exports.conditionalGET()</h2><div class="description"><p>Check if <code>req</code> is a conditional GET request.</p></div><ul class="tags"><li><em>IncomingMessage</em> req </li><li>returns <em>Boolean</em> </li></ul><h3>Source</h3><pre><code>exports.conditionalGET = function(req) {
  return req.headers['if-modified-since']
    || req.headers['if-none-match'];
};</code></pre></div><div id="exports.unauthorized" class="comment"><h2>exports.unauthorized()</h2><div class="description"><p>Respond with 401 "Unauthorized".</p></div><ul class="tags"><li><em>ServerResponse</em> res </li><li><em>String</em> realm </li></ul><h3>Source</h3><pre><code>exports.unauthorized = function(res, realm) {
  res.statusCode = 401;
  res.setHeader('WWW-Authenticate', 'Basic realm="' + realm + '"');
  res.end('Unauthorized');
};</code></pre></div><div id="exports.notModified" class="comment"><h2>exports.notModified()</h2><div class="description"><p>Respond with 304 "Not Modified".</p></div><ul class="tags"><li><em>ServerResponse</em> res </li><li><em>Object</em> headers </li></ul><h3>Source</h3><pre><code>exports.notModified = function(res) {
  exports.removeContentHeaders(res);
  res.statusCode = 304;
  res.end();
};</code></pre></div><div id="exports.etag" class="comment"><h2>exports.etag()</h2><div class="description"><p>Return an ETag in the form of <code>"&lt;size&gt;-&lt;mtime&gt;"</code><br />from the given <code>stat</code>.</p></div><ul class="tags"><li><em>Object</em> stat </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>exports.etag = function(stat) {
  return '"' + stat.size + '-' + Number(stat.mtime) + '"';
};</code></pre></div><div id="exports.parseCacheControl" class="comment"><h2>exports.parseCacheControl()</h2><div class="description"><p>Parse the given Cache-Control <code>str</code>.</p></div><ul class="tags"><li><em>String</em> str </li><li>returns <em>Object</em> </li></ul><h3>Source</h3><pre><code>exports.parseCacheControl = function(str){
  var directives = str.split(',')
    , obj = {};

  for(var i = 0, len = directives.length; i < len; i++) {
    var parts = directives[i].split('=')
      , key = parts.shift().trim()
      , val = parseInt(parts.shift(), 10);

    obj[key] = isNaN(val) ? true : val;
  }

  return obj;
};</code></pre></div><div id="exports.parseUrl" class="comment"><h2>exports.parseUrl()</h2><div class="description"><p>Parse the <code>req</code> url with memoization.</p></div><ul class="tags"><li><em>ServerRequest</em> req </li><li>returns <em>Object</em> </li></ul><h3>Source</h3><pre><code>exports.parseUrl = function(req){
  var parsed = req._parsedUrl;
  if (parsed && parsed.href == req.url) {
    return parsed;
  } else {
    return req._parsedUrl = parse(req.url);
  }
};</code></pre></div><div id="exports.parseBytes" class="comment"><h2>exports.parseBytes</h2><div class="description"><p>Parse byte <code>size</code> string.</p></div><ul class="tags"><li><em>String</em> size </li><li>returns <em>Number</em> </li></ul><h3>Source</h3><pre><code>exports.parseBytes = require('bytes');</code></pre></div><div id="exports.normalizeSlashes" class="comment"><h2>exports.normalizeSlashes()</h2><div class="description"><p>Normalizes the path separator from system separator<br />to URL separator, aka <code>/</code>.</p></div><ul class="tags"><li><em>String</em> path </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>exports.normalizeSlashes = function normalizeSlashes(path) {
  return path.split(sep).join('/');
};

function noop() {}</code></pre></div></div><ul id="menu"><li><a href="#exports.hasBody">exports.hasBody()</a></li><li><a href="#exports.mime">exports.mime()</a></li><li><a href="#exports.error">exports.error()</a></li><li><a href="#exports.md5">exports.md5()</a></li><li><a href="#exports.merge">exports.merge()</a></li><li><a href="#exports.escape">exports.escape()</a></li><li><a href="#exports.sign">exports.sign()</a></li><li><a href="#exports.unsign">exports.unsign()</a></li><li><a href="#exports.parseSignedCookies">exports.parseSignedCookies()</a></li><li><a href="#exports.parseSignedCookie">exports.parseSignedCookie()</a></li><li><a href="#exports.parseJSONCookies">exports.parseJSONCookies()</a></li><li><a href="#exports.parseJSONCookie">exports.parseJSONCookie()</a></li><li><a href="#exports.pause">exports.pause</a></li><li><a href="#exports.removeContentHeaders">exports.removeContentHeaders()</a></li><li><a href="#exports.conditionalGET">exports.conditionalGET()</a></li><li><a href="#exports.unauthorized">exports.unauthorized()</a></li><li><a href="#exports.notModified">exports.notModified()</a></li><li><a href="#exports.etag">exports.etag()</a></li><li><a href="#exports.parseCacheControl">exports.parseCacheControl()</a></li><li><a href="#exports.parseUrl">exports.parseUrl()</a></li><li><a href="#exports.parseBytes">exports.parseBytes</a></li><li><a href="#exports.normalizeSlashes">exports.normalizeSlashes()</a></li></ul></body></html>